<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Popup Size Test</title>
    <style>
      body {
        margin: 0;
        padding: 20px;
        font-family: Arial, sans-serif;
        background: #f0f0f0;
      }

      .test-container {
        background: white;
        padding: 20px;
        border-radius: 8px;
        margin-bottom: 20px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      }

      .popup-frame {
        border: 2px solid #333;
        border-radius: 12px;
        overflow: hidden;
        display: inline-block;
        background: white;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
      }

      iframe {
        border: none;
        display: block;
      }

      .size-info {
        margin-top: 10px;
        padding: 10px;
        background: #e8f4f8;
        border-radius: 4px;
        font-family: monospace;
      }
    </style>
  </head>
  <body>
    <h1>Popup Size Test</h1>

    <div class="test-container">
      <h2>Current Popup Size</h2>
      <p>This should show a 320px wide popup:</p>

      <div class="popup-frame" id="popup-container">
        <iframe
          src="dist/src/popup/index.html"
          width="320"
          height="500"
          id="popup-iframe"
        ></iframe>
      </div>

      <div class="size-info" id="size-info">Loading size information...</div>
    </div>

    <div class="test-container">
      <h2>Extension Context Simulation</h2>
      <p>Simulating browser extension popup constraints:</p>

      <div
        class="popup-frame"
        style="width: 320px; height: 500px; overflow: hidden"
      >
        <iframe
          src="dist/src/popup/index.html"
          width="320"
          height="500"
          style="transform-origin: top left"
        ></iframe>
      </div>
    </div>

    <script>
      const iframe = document.getElementById("popup-iframe");
      const sizeInfo = document.getElementById("size-info");

      iframe.onload = function () {
        try {
          const iframeDoc =
            iframe.contentDocument || iframe.contentWindow.document;
          const popup = iframeDoc.querySelector(".chronow-popup");

          if (popup) {
            const rect = popup.getBoundingClientRect();
            const computedStyle = iframe.contentWindow.getComputedStyle(popup);
            const rootStyle = iframe.contentWindow.getComputedStyle(
              iframeDoc.documentElement,
            );

            const popupWidthVar = rootStyle
              .getPropertyValue("--popup-width")
              .trim();

            sizeInfo.innerHTML = `
                        <strong>Popup Dimensions:</strong><br>
                        Actual Width: ${Math.round(rect.width)}px<br>
                        Actual Height: ${Math.round(rect.height)}px<br>
                        CSS Variable --popup-width: ${popupWidthVar}<br>
                        Computed Width: ${computedStyle.width}<br>
                        Min Width: ${computedStyle.minWidth}<br>
                        Max Width: ${computedStyle.maxWidth}
                    `;
          } else {
            sizeInfo.innerHTML = "Popup element not found";
          }
        } catch (error) {
          sizeInfo.innerHTML = `Error: ${error.message}`;
        }
      };

      // Check viewport size
      window.addEventListener("resize", function () {});
    </script>
  </body>
</html>
